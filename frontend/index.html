<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceShield AI - Voice Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body class="min-h-screen p-4 md:p-8 flex items-center justify-center">
    <!-- Animated background -->
    <div class="mesh-bg"></div>

    <div class="max-w-5xl w-full mx-auto">
        <!-- Header -->
        <header class="text-center mb-16 reveal-anim">
            <div
                class="inline-flex items-center justify-center bg-sky-500/10 border border-sky-500/20 rounded-full px-4 py-1.5 mb-6">
                <span class="flex h-2 w-2 mr-2">
                    <span class="animate-ping absolute inline-flex h-2 w-2 rounded-full bg-sky-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-sky-500"></span>
                </span>
                <span class="text-xs font-bold text-sky-400 uppercase tracking-widest">v1.2 Advanced Engine</span>
            </div>
            <div class="flex items-center justify-center mb-4">
                <i
                    class="fas fa-fingerprint text-5xl text-sky-400 mr-4 filter drop-shadow-[0_0_8px_rgba(56,189,248,0.5)]"></i>
                <h1 class="text-5xl md:text-6xl font-bold tracking-tight">Voice<span class="gradient-text">Shield</span>
                </h1>
            </div>
            <p class="text-slate-400 text-lg max-w-lg mx-auto leading-relaxed">High-fidelity acoustic fingerprinting to
                verify the origin of human speech.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <!-- Left Side: Control Panel -->
            <div class="lg:col-span-5 space-y-6 reveal-anim" style="animation-delay: 0.1s">
                <div class="glass-card p-8">
                    <h3 class="text-xl font-semibold mb-6 flex items-center">
                        <i class="fas fa-sliders-h mr-3 text-sky-400"></i>
                        Analysis Parameters
                    </h3>

                    <!-- Language Selection -->
                    <div class="mb-8">
                        <label class="block text-sm font-medium text-slate-400 mb-3 uppercase tracking-wider">Detection
                            Language</label>
                        <div class="grid grid-cols-2 gap-3" id="lang-grid">
                            <button onclick="selectLang('english')"
                                class="lang-btn px-4 py-3 rounded-xl border border-white/5 bg-white/5 hover:bg-white/10 transition-all text-sm font-medium active-lang"
                                data-lang="english">
                                <span class="block text-lg mb-1">ðŸ‡ºðŸ‡¸</span> English
                            </button>
                            <button onclick="selectLang('hindi')"
                                class="lang-btn px-4 py-3 rounded-xl border border-white/5 bg-white/5 hover:bg-white/10 transition-all text-sm font-medium"
                                data-lang="hindi">
                                <span class="block text-lg mb-1">ðŸ‡®ðŸ‡³</span> Hindi
                            </button>
                            <button onclick="selectLang('tamil')"
                                class="lang-btn px-4 py-3 rounded-xl border border-white/5 bg-white/5 hover:bg-white/10 transition-all text-sm font-medium"
                                data-lang="tamil">
                                <span class="block text-lg mb-1">ðŸ‡®ðŸ‡³</span> Tamil
                            </button>
                            <button onclick="selectLang('malayalam')"
                                class="lang-btn px-4 py-3 rounded-xl border border-white/5 bg-white/5 hover:bg-white/10 transition-all text-sm font-medium"
                                data-lang="malayalam">
                                <span class="block text-lg mb-1">ðŸ‡®ðŸ‡³</span> Malayalam
                            </button>
                            <button onclick="selectLang('telugu')"
                                class="lang-btn px-4 py-3 rounded-xl border border-white/5 bg-white/5 hover:bg-white/10 transition-all text-sm font-medium"
                                data-lang="telugu">
                                <span class="block text-lg mb-1">ðŸ‡®ðŸ‡³</span> Telugu
                            </button>
                        </div>
                    </div>

                    <!-- File Upload -->
                    <div id="drop-zone" class="upload-area rounded-2xl p-8 text-center cursor-pointer group">
                        <input type="file" id="audio-input" class="hidden" accept="audio/*">
                        <div id="upload-prompt" class="mb-4">
                            <div
                                class="w-16 h-16 bg-sky-500/10 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                                <i class="fas fa-cloud-arrow-up text-2xl text-sky-400"></i>
                            </div>
                            <p class="text-sm font-semibold text-slate-200">Drop audio file here</p>
                            <p class="text-xs text-slate-500 mt-1">MP3, WAV, M4A (Max 10MB)</p>
                        </div>
                        <div id="file-info" class="hidden">
                            <div class="bg-white/5 rounded-lg p-3 flex items-center text-left">
                                <i class="far fa-file-audio text-sky-400 mr-3 text-xl"></i>
                                <div class="overflow-hidden">
                                    <p id="file-name" class="text-sm font-medium truncate"></p>
                                    <p id="file-size" class="text-xs text-slate-500"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="analyze-btn" disabled
                        class="w-full mt-6 bg-sky-500 hover:bg-sky-400 disabled:opacity-50 disabled:cursor-not-allowed text-slate-900 font-bold py-4 rounded-xl transition-all btn-glow flex items-center justify-center space-x-3">
                        <span>Initiate Scan</span>
                        <i class="fas fa-bolt"></i>
                    </button>
                </div>

                <!-- Capabilities Card -->
                <div class="glass-card p-6 bg-sky-500/5">
                    <div class="flex items-center text-xs font-bold text-sky-400 uppercase tracking-widest mb-4">
                        <i class="fas fa-microchip mr-2"></i> Engine Features
                    </div>
                    <ul class="text-sm space-y-3 text-slate-400">
                        <li class="flex items-center"><i class="fas fa-check-circle text-sky-500/50 mr-2 text-xs"></i>
                            Pitch Variance Analysis</li>
                        <li class="flex items-center"><i class="fas fa-check-circle text-sky-500/50 mr-2 text-xs"></i>
                            Spectral Flatness Check</li>
                        <li class="flex items-center"><i class="fas fa-check-circle text-sky-500/50 mr-2 text-xs"></i>
                            Multi-lingual Heuristics</li>
                    </ul>
                </div>
            </div>

            <!-- Right Side: Visualization & Results -->
            <div class="lg:col-span-7 reveal-anim" style="animation-delay: 0.2s">
                <div id="result-container" class="glass-card min-h-[500px] flex flex-col overflow-hidden">
                    <!-- Default State -->
                    <div id="empty-state" class="flex-1 flex flex-col items-center justify-center p-12 text-center">
                        <div class="wave-container mb-6">
                            <div class="wave-bar" style="animation-delay: 0.1s"></div>
                            <div class="wave-bar" style="animation-delay: 0.2s"></div>
                            <div class="wave-bar" style="animation-delay: 0.3s"></div>
                            <div class="wave-bar" style="animation-delay: 0.4s"></div>
                            <div class="wave-bar" style="animation-delay: 0.5s"></div>
                            <div class="wave-bar" style="animation-delay: 0.6s"></div>
                        </div>
                        <h4 class="text-slate-500 font-medium mb-2">Awaiting Input Signal</h4>
                        <p class="text-sm text-slate-600 max-w-xs leading-relaxed">Upload an audio sample to start the
                            neural fingerprinting process.</p>
                    </div>

                    <!-- Loading State -->
                    <div id="loading-state"
                        class="hidden flex-1 flex flex-col items-center justify-center p-12 scanning">
                        <div class="spinner mb-6"></div>
                        <h4 class="text-xl font-bold mb-2">Isolating Patterns</h4>
                        <p class="text-slate-400 animate-pulse">Running acoustic feature extraction...</p>
                    </div>

                    <!-- Results State -->
                    <div id="data-state" class="hidden flex-1 p-8">
                        <div class="flex items-center justify-between mb-8 border-b border-white/5 pb-6">
                            <div>
                                <h3 class="text-2xl font-bold">Analysis Complete</h3>
                                <p class="text-slate-400 text-sm">Processed using v1.2 engine</p>
                            </div>
                            <div id="result-badge"
                                class="px-5 py-2 rounded-full font-bold text-sm tracking-widest uppercase"></div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <div class="bg-white/5 rounded-2xl p-5 border border-white/5">
                                <p class="text-xs font-bold text-slate-500 uppercase mb-2">Confidence</p>
                                <p id="res-score" class="text-3xl font-bold"></p>
                            </div>
                            <div class="bg-white/5 rounded-2xl p-5 border border-white/5">
                                <p class="text-xs font-bold text-slate-500 uppercase mb-2">Language</p>
                                <p id="res-lang" class="text-2xl font-bold text-sky-400"></p>
                            </div>
                            <div class="bg-white/5 rounded-2xl p-5 border border-white/5">
                                <p class="text-xs font-bold text-slate-500 uppercase mb-2">Integrity</p>
                                <p id="res-status" class="text-lg font-bold"></p>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <h4 class="font-semibold text-slate-300 flex items-center">
                                <i class="fas fa-list-check mr-2 text-sky-400"></i>
                                Heuristic Insights
                            </h4>
                            <div id="res-insights" class="space-y-2">
                                <!-- Dynamic insights go here -->
                            </div>
                        </div>

                        <div class="mt-auto pt-8">
                            <button onclick="resetUI()"
                                class="text-slate-500 hover:text-slate-300 transition-colors text-sm font-medium flex items-center">
                                <i class="fas fa-redo-alt mr-2"></i> Clear and Analyze New Sample
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-16 text-center reveal-anim" style="animation-delay: 0.4s">
            <p class="text-slate-600 text-xs font-medium tracking-[0.2em] uppercase">
                Enterprise Shield &bull; Local Secure Node 8001
            </p>
        </footer>
    </div>

    <script>
        // State Management
        let selectedLanguage = 'english';
        let currentFileBase64 = null;

        const dom = {
            dropZone: document.getElementById('drop-zone'),
            fileInput: document.getElementById('audio-input'),
            uploadPrompt: document.getElementById('upload-prompt'),
            fileInfo: document.getElementById('file-info'),
            fileName: document.getElementById('file-name'),
            fileSize: document.getElementById('file-size'),
            analyzeBtn: document.getElementById('analyze-btn'),

            emptyState: document.getElementById('empty-state'),
            loadingState: document.getElementById('loading-state'),
            dataState: document.getElementById('data-state'),

            badge: document.getElementById('result-badge'),
            score: document.getElementById('res-score'),
            lang: document.getElementById('res-lang'),
            status: document.getElementById('res-status'),
            insights: document.getElementById('res-insights')
        };

        // Language Selection
        window.selectLang = (lang) => {
            selectedLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active-lang');
                if (btn.dataset.lang === lang) btn.classList.add('active-lang');
            });
        };

        // File Handlers
        dom.dropZone.onclick = () => dom.fileInput.click();
        dom.fileInput.onchange = (e) => handleFileSelection(e.target.files[0]);

        dom.dropZone.ondragover = (e) => {
            e.preventDefault();
            dom.dropZone.classList.add('active');
        };

        dom.dropZone.ondragleave = () => dom.dropZone.classList.remove('active');

        dom.dropZone.ondrop = (e) => {
            e.preventDefault();
            dom.dropZone.classList.remove('active');
            handleFileSelection(e.dataTransfer.files[0]);
        };

        function handleFileSelection(file) {
            if (!file) return;

            if (!file.type.match('audio.*')) {
                alert('Invalid file format. Please upload an audio file.');
                return;
            }

            dom.fileName.textContent = file.name;
            dom.fileSize.textContent = `${(file.size / (1024 * 1024)).toFixed(2)} MB`;

            const reader = new FileReader();
            reader.onload = (e) => {
                currentFileBase64 = e.target.result.split(',')[1];
                dom.uploadPrompt.classList.add('hidden');
                dom.fileInfo.classList.remove('hidden');
                dom.analyzeBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        function resetUI() {
            currentFileBase64 = null;
            dom.fileInput.value = '';
            dom.uploadPrompt.classList.remove('hidden');
            dom.fileInfo.classList.add('hidden');
            dom.analyzeBtn.disabled = true;

            dom.dataState.classList.add('hidden');
            dom.loadingState.classList.add('hidden');
            dom.emptyState.classList.remove('hidden');
        }

        // API Integration
        dom.analyzeBtn.onclick = async () => {
            // UI State
            dom.emptyState.classList.add('hidden');
            dom.loadingState.classList.remove('hidden');
            dom.analyzeBtn.disabled = true;

            try {
                const response = await fetch('http://127.0.0.1:8001/api/voice-detection', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        language: selectedLanguage,
                        audioFormat: 'mp3',
                        audioBase64: currentFileBase64
                    })
                });

                const data = await response.json();

                if (response.ok && data.status === 'success') {
                    showResults(data);
                } else {
                    alert(`Error: ${data.detail?.message || 'Analysis failed'}`);
                    resetUI();
                }
            } catch (err) {
                alert('Connection Error: Is the backend server running on port 8001?');
                resetUI();
            }
        };

        function showResults(data) {
            dom.loadingState.classList.add('hidden');
            dom.dataState.classList.remove('hidden');

            const isAI = data.classification === 'AI_GENERATED';

            // Badge Styles
            dom.badge.textContent = isAI ? 'Synthetic' : 'Authentic';
            dom.badge.className = isAI ?
                'px-5 py-2 rounded-full font-bold text-sm tracking-widest uppercase bg-rose-500/10 text-rose-500 border border-rose-500/20' :
                'px-5 py-2 rounded-full font-bold text-sm tracking-widest uppercase bg-emerald-500/10 text-emerald-500 border border-emerald-500/20';

            // Metrics
            dom.score.textContent = `${Math.round(data.confidenceScore * 100)}%`;
            dom.lang.textContent = data.language;
            dom.status.textContent = isAI ? 'AI Detected' : 'Human Verified';
            dom.status.className = isAI ? 'text-lg font-bold text-rose-500' : 'text-lg font-bold text-emerald-500';

            // Insights
            dom.insights.innerHTML = '';
            const insights = data.explanation.split('.').filter(s => s.trim().length > 0);
            insights.forEach(text => {
                const div = document.createElement('div');
                div.className = 'flex items-start p-3 bg-white/5 rounded-xl border border-white/5 text-sm text-slate-300';
                div.innerHTML = `<i class="fas fa-info-circle mt-1 mr-3 text-sky-400"></i><span>${text.trim()}.</span>`;
                dom.insights.appendChild(div);
            });
        }
    </script>
</body>

</html>