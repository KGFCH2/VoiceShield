<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceShield AI | AI Voice Detector</title>

    <!-- Meta Tags for SEO & Social Sharing -->
    <meta name="description"
        content="Advanced AI voice detection system. Check if any voice is human or AI-generated in seconds.">
    <meta property="og:title" content="VoiceShield AI | AI Voice Detector">
    <meta property="og:description" content="Detect AI-generated speech with high-fidelity acoustic fingerprinting.">
    <meta property="og:image" content="https://voice-shield.vercel.app/og-image.png">
    <meta property="og:url" content="https://voice-shield.vercel.app/">
    <meta name="twitter:card" content="summary_large_image">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body class="min-h-screen p-4 md:p-8 flex items-center justify-center">
    <!-- Animated background -->
    <div class="mesh-bg"></div>

    <!-- Server Status Indicator -->
    <div class="fixed top-4 right-4 z-50">
        <div id="server-status"
            class="glass-card px-3 py-1.5 flex items-center gap-2 text-[10px] font-bold tracking-widest uppercase opacity-60">
            <div id="status-dot" class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></div>
            <span class="text-gray-300">API: <span id="status-text">CONNECTING</span></span>
        </div>
    </div>

    <div class="max-w-5xl w-full mx-auto">
        <!-- Header -->
        <header class="text-center mb-10 reveal-anim">
            <div class="flex items-center justify-center mb-2">
                <i
                    class="fas fa-fingerprint text-4xl text-sky-400 mr-3 filter drop-shadow-[0_0_8px_rgba(56,189,248,0.5)]"></i>
                <h1 class="text-4xl md:text-5xl font-bold tracking-tight">Voice<span class="gradient-text">Shield</span>
                </h1>
            </div>
            <p class="text-slate-400 text-base max-w-lg mx-auto leading-relaxed">Check if a voice is real or made by AI.
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-center">
            <!-- Left Side: Settings Panel -->
            <div class="lg:col-span-4 space-y-4 reveal-anim" style="animation-delay: 0.1s">
                <div class="glass-card p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-cog mr-3 text-sky-400"></i>
                        Upload Audio
                    </h3>

                    <!-- File Upload -->
                    <div id="drop-zone" class="upload-area rounded-xl p-6 text-center cursor-pointer group">
                        <input type="file" id="audio-input" class="hidden" accept="audio/*">
                        <div id="upload-prompt">
                            <i class="fas fa-upload text-xl text-sky-400 mb-2 block"></i>
                            <p class="text-sm font-semibold text-slate-200">Click to upload audio</p>
                            <p class="text-xs text-slate-500">MP3 or WAV works best</p>
                        </div>
                        <div id="file-info" class="hidden">
                            <div class="bg-white/5 rounded-lg p-2 flex items-center text-left">
                                <i class="far fa-file-audio text-sky-400 mr-2"></i>
                                <div class="overflow-hidden">
                                    <p id="file-name" class="text-xs font-medium truncate"></p>
                                    <p id="file-size" class="text-[10px] text-slate-500"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="analyze-btn" disabled
                        class="w-full mt-4 bg-sky-500 hover:bg-sky-400 disabled:opacity-50 disabled:cursor-not-allowed text-slate-900 font-bold py-3 rounded-lg transition-all btn-glow flex items-center justify-center space-x-2">
                        <span>Check Voice</span>
                        <i class="fas fa-play text-xs"></i>
                    </button>
                </div>
            </div>

            <!-- Right Side: Visualization & Results -->
            <div class="lg:col-span-8 reveal-anim" style="animation-delay: 0.2s">
                <div id="result-container" class="glass-card min-h-[400px] flex flex-col overflow-hidden">
                    <!-- Default State -->
                    <div id="empty-state" class="flex-1 flex flex-col items-center justify-center p-8 text-center">
                        <div class="wave-container mb-4">
                            <div class="wave-bar" style="animation-delay: 0.1s"></div>
                            <div class="wave-bar" style="animation-delay: 0.2s"></div>
                            <div class="wave-bar" style="animation-delay: 0.3s"></div>
                            <div class="wave-bar" style="animation-delay: 0.4s"></div>
                        </div>
                        <h4 class="text-slate-500 font-medium mb-1">Ready to Test</h4>
                        <p class="text-xs text-slate-600 max-w-xs">Upload an audio file to see if it is human or AI.</p>
                    </div>

                    <!-- Loading State -->
                    <div id="loading-state"
                        class="hidden flex-1 flex flex-col items-center justify-center p-12 scanning">
                        <div class="loader-visual mb-6">
                            <div class="loader-ring"></div>
                            <div class="loader-ring"></div>
                            <div class="loader-ring"></div>
                            <i class="fas fa-shield-halved text-3xl text-sky-400 loader-icon"></i>
                        </div>
                        <h4 class="text-xl font-bold mb-2 tracking-tight">Protecting Analysis</h4>
                        <p class="text-slate-400 text-sm animate-pulse text-center">Running high-fidelity scan...</p>
                        <p class="text-[10px] text-slate-500 mt-2 text-center">Initial analysis usually takes 45 seconds
                        </p>
                        <div class="mt-8 flex gap-1">
                            <span class="loading-dot"></span>
                            <span class="loading-dot"></span>
                            <span class="loading-dot"></span>
                        </div>
                    </div>

                    <!-- Results State -->
                    <div id="data-state" class="hidden flex-1 p-6">
                        <div class="flex items-center justify-between mb-6 border-b border-white/5 pb-4">
                            <h3 class="text-xl font-bold">Result</h3>
                            <div id="result-badge"
                                class="px-4 py-1.5 rounded-full font-bold text-xs uppercase tracking-wider"></div>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-6">
                            <div class="bg-white/5 rounded-xl p-4 border border-white/5">
                                <p class="text-[10px] font-bold text-slate-500 uppercase mb-1">Certainty</p>
                                <p id="res-score" class="text-2xl font-bold"></p>
                            </div>
                            <div class="bg-white/5 rounded-xl p-4 border border-white/5">
                                <p class="text-[10px] font-bold text-slate-500 uppercase mb-1">Type</p>
                                <p id="res-status" class="text-base font-bold"></p>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <h4 class="text-sm font-semibold text-slate-300">Why this result?</h4>
                            <div id="res-insights" class="space-y-2 text-xs">
                                <!-- Dynamic insights go here -->
                            </div>
                        </div>

                        <div class="mt-8">
                            <button onclick="resetUI()"
                                class="text-slate-500 hover:text-sky-400 transition-all duration-300 text-xs font-medium flex items-center hover:translate-x-1">
                                <i class="fas fa-undo mr-2"></i> Start Over
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-12 text-center reveal-anim" style="animation-delay: 0.4s">
            <p class="text-slate-500 text-xs font-semibold tracking-wider">
                Made with <i class="fas fa-heart text-rose-500 animate-pulse mx-1"></i> by <span
                    class="text-sky-400">Babin</span>
            </p>
            <p class="text-slate-600 text-[10px] font-bold tracking-widest uppercase mt-2 opacity-50">
                Secure Voice Detection Node
            </p>
        </footer>
    </div>

    <script>
        // API Configuration
        const API_BASE = 'https://voiceshield-tz3i.onrender.com/api';
        const DEMO_KEY = 'sk_test_123456789';

        // State Management
        let selectedLanguage = 'English';
        let currentFileBase64 = null;

        const dom = {
            dropZone: document.getElementById('drop-zone'),
            fileInput: document.getElementById('audio-input'),
            uploadPrompt: document.getElementById('upload-prompt'),
            fileInfo: document.getElementById('file-info'),
            fileName: document.getElementById('file-name'),
            fileSize: document.getElementById('file-size'),
            analyzeBtn: document.getElementById('analyze-btn'),

            emptyState: document.getElementById('empty-state'),
            loadingState: document.getElementById('loading-state'),
            dataState: document.getElementById('data-state'),

            badge: document.getElementById('result-badge'),
            score: document.getElementById('res-score'),
            status: document.getElementById('res-status'),
            insights: document.getElementById('res-insights'),

            // Status Elements
            statusDot: document.getElementById('status-dot'),
            statusText: document.getElementById('status-text')
        };

        // Server Health Check
        async function checkServerStatus() {
            try {
                const start = Date.now();
                const res = await fetch(`${API_BASE}/health`);
                if (res.ok) {
                    dom.statusDot.className = 'w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981]';
                    dom.statusText.textContent = 'ONLINE';
                    dom.statusText.className = 'text-emerald-400';
                }
            } catch (e) {
                dom.statusDot.className = 'w-2 h-2 rounded-full bg-rose-500 shadow-[0_0_8px_#f43f5e]';
                dom.statusText.textContent = 'OFFLINE';
                dom.statusText.className = 'text-rose-400';
            }
        }

        // Initialize status check
        checkServerStatus();
        setInterval(checkServerStatus, 30000);

        // File Handlers
        dom.dropZone.onclick = () => dom.fileInput.click();
        dom.fileInput.onchange = (e) => handleFileSelection(e.target.files[0]);

        dom.dropZone.ondragover = (e) => {
            e.preventDefault();
            dom.dropZone.classList.add('active');
        };

        dom.dropZone.ondragleave = () => dom.dropZone.classList.remove('active');

        dom.dropZone.ondrop = (e) => {
            e.preventDefault();
            dom.dropZone.classList.remove('active');
            handleFileSelection(e.dataTransfer.files[0]);
        };

        function handleFileSelection(file) {
            if (!file) return;

            if (!file.type.match('audio.*')) {
                alert('Invalid file format. Please upload an audio file.');
                return;
            }

            dom.fileName.textContent = file.name;
            dom.fileSize.textContent = `${(file.size / (1024 * 1024)).toFixed(2)} MB`;

            const reader = new FileReader();
            reader.onload = (e) => {
                currentFileBase64 = e.target.result.split(',')[1];
                dom.uploadPrompt.classList.add('hidden');
                dom.fileInfo.classList.remove('hidden');
                dom.analyzeBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        function resetUI() {
            currentFileBase64 = null;
            dom.fileInput.value = '';
            dom.uploadPrompt.classList.remove('hidden');
            dom.fileInfo.classList.add('hidden');
            dom.analyzeBtn.disabled = true;

            dom.dataState.classList.add('hidden');
            dom.loadingState.classList.add('hidden');
            dom.emptyState.classList.remove('hidden');

            // Reset loading text
            const loadingText = dom.loadingState.querySelector('p.text-slate-400');
            const subText = dom.loadingState.querySelector('p.text-[10px]');
            if (loadingText) loadingText.innerHTML = 'Running high-fidelity scan...';
            if (subText) {
                subText.textContent = 'Initial analysis usually takes 45 seconds';
                subText.className = 'text-[10px] text-slate-500 mt-2 text-center';
            }
        }

        // API Integration
        dom.analyzeBtn.onclick = async () => {
            // UI State
            dom.emptyState.classList.add('hidden');
            dom.loadingState.classList.remove('hidden');
            dom.analyzeBtn.disabled = true;

            // Set a timeout for the "waking up" message
            const wakeupTimer = setTimeout(() => {
                const loadingText = dom.loadingState.querySelector('p.text-slate-400');
                const subText = dom.loadingState.querySelector('p.text-[10px]');
                if (loadingText) {
                    loadingText.innerHTML = 'Connecting to Secure API Node...<br><span class="text-sky-400 font-bold uppercase tracking-tighter">Please Wait: Server is Waking Up</span>';
                    loadingText.classList.add('text-center');
                }
                if (subText) {
                    subText.textContent = 'This may take around 2 minutes if the server was inactive.';
                    subText.classList.remove('text-slate-500');
                    subText.classList.add('text-yellow-500/80', 'font-medium');
                }
            }, 5000);

            try {
                const response = await fetch(`${API_BASE}/voice-detection`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': DEMO_KEY
                    },
                    body: JSON.stringify({
                        language: selectedLanguage,
                        audioFormat: 'mp3',
                        audioBase64: currentFileBase64
                    })
                });

                clearTimeout(wakeupTimer);

                const data = await response.json();

                if (response.ok && data.status === 'success') {
                    showResults(data);
                } else {
                    alert(`Error: ${data.detail?.message || 'Analysis failed'}`);
                    resetUI();
                }
            } catch (err) {
                alert('Connection Error: Could not reach the VoiceShield API server.');
                resetUI();
            }
        };

        function showResults(data) {
            dom.loadingState.classList.add('hidden');
            dom.dataState.classList.remove('hidden');

            const isAI = data.classification === 'AI_GENERATED';

            // Badge Styles
            dom.badge.textContent = isAI ? 'Synthetic' : 'Authentic';
            dom.badge.className = isAI ?
                'px-5 py-2 rounded-full font-bold text-sm tracking-widest uppercase bg-rose-500/10 text-rose-500 border border-rose-500/20' :
                'px-5 py-2 rounded-full font-bold text-sm tracking-widest uppercase bg-emerald-500/10 text-emerald-500 border border-emerald-500/20';

            // Metrics
            dom.score.textContent = `${Math.round(data.confidenceScore * 100)}%`;
            dom.status.textContent = isAI ? 'AI Detected' : 'Human Verified';
            dom.status.className = isAI ? 'text-lg font-bold text-rose-500' : 'text-lg font-bold text-emerald-500';

            // Insights
            dom.insights.innerHTML = '';
            const insights = data.explanation.split('.').filter(s => s.trim().length > 0);
            insights.forEach(text => {
                const div = document.createElement('div');
                div.className = 'flex items-start p-3 bg-white/5 rounded-xl border border-white/5 text-sm text-slate-300 insight-card cursor-default';
                div.innerHTML = `<i class="fas fa-info-circle mt-1 mr-3 text-sky-400"></i><span>${text.trim()}.</span>`;
                dom.insights.appendChild(div);
            });
        }
    </script>
</body>

</html>